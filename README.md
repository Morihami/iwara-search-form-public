# Iwara検索フォーム Ver 0.1

Iwaraの複雑な検索条件を、シンプルなフォームで簡単に作成できるツールです。

## 最近のアップデート（2025-12-26）

- タグ選択ダイアログ（`tags_all.json`）でタグを検索・追加
- タグ/タグ（除外）はチップ表示、クリックで解除
- センシティブなタグは赤地表示（`sensitive: true`）
- 更新日（カレンダー入力）や長さ/評価/反応数の範囲指定に対応
- 保存済み条件（名前付き）でフォームを復元
- 検索ボタンからIwara検索を新しいタブで開く

## 🌟 特徴

- **直感的なUI**: 複雑な検索式を覚える必要なし
- **リアルタイムプレビュー**: 入力内容が即座に検索式として表示
- **完全クライアントサイド**: データは送信されず、ブラウザ内で完結

## 🚀 使い方

### 基本的な使用方法

1. `index.html` をブラウザで開く
   - 公開ページ: https://morihami.github.io/iwara-search-form-public/
2. フォームに検索条件を入力
3. 自動的に検索式が生成される
4. 「コピー」ボタンで検索式をクリップボードにコピー
5. Iwaraの検索ボックスに貼り付けて使用


## 📖 機能説明

### タグ検索

- **AND条件**: すべてのタグを含む動画を検索
- **OR条件**: いずれかのタグを含む動画を検索
- **NOT条件**: 特定のタグを含む動画を除外

複数のタグはカンマ（,）で区切って入力します。

**例**:
- AND条件に「mmd, dance」→ MMDかつダンスの動画
- OR条件に「r18, ecchi」→ R-18またはエッチな動画
- NOT条件に「guro」→ グロを除外

### ユーザー検索

特定のユーザーの動画を検索したり、除外したりできます。

- **ユーザー条件**: 「絞り込む」か「除外する」を選択
- **ユーザー名**: 投稿者（author）を指定（カンマ区切り）

### レーティング検索

動画のレーティングで絞り込みができます。

- 一般（General）
- エッチ（Ecchi）

### タイトル・詳細

タイトルと詳細（本文）で部分一致検索できます。ローカライズ対応のため `_ja` を使用します。

- **タイトル**: `{title_ja: キーワード}`
- **詳細**: `{body_ja: キーワード}`

## 🔍 検索式リファレンス

Iwara側の「高度なフィルタリング（UI未提供）」の構文メモは `ADVANCED_FILTERING.md` を参照してください。

### 基本演算子

| 演算子 | 説明 | 例 |
|--------|------|-----|
| スペース（AND） | すべての条件を満たす | `{tags: [mmd]} {tags: [dance]}` |
| `OR` | いずれかの条件を満たす | `{tags: [r18, ecchi]}` |
| `-` | キーワードを除外 | `-miku` |
| `!` | フィールド条件を除外 | `{tags: ![guro]}` |

### フィールド指定

| フィールド | 説明 | 例 |
|-----------|------|-----|
| `{title_ja: ...}` | タイトル | `{title_ja: miku}` |
| `{body_ja: ...}` | 詳細 | `{body_ja: dance}` |
| `{author: [...]}` | 作者 | `{author: [username]}` |
| `{rating=...}` | レーティング | `{rating=general}` |
| `{duration: [..]}` | 長さ（秒） | `{duration: [60..120]}` |
| `{likes: [..]}` | Likes | `{likes: [10..]}` |
| `{views: [..]}` | Views | `{views: [100..]}` |
| `{comments: [..]}` | Comments | `{comments: [5..]}` |
| `{tags: [...]}` | タグ | `{tags: [mmd]}` |
| `{date: [..]}` | 更新日（UNIX） | `{date: [1700000000..1709999999]}` |

## 💡 使用例

### 例1: MMDダンス動画（R-18除外）

**入力**:
- タグ（AND条件）: `mmd, dance`
- タグ（NOT条件）: `r18`

**生成される検索式**:
```
{tags: [mmd]} {tags: [dance]} {tags: ![r18]}
```

README内の使用例は、ページ上の「この条件をフォームに反映」ボタンを押すとそのままフォームにセットされるので、そのまま編集やコピーができます。

### 例2: 特定ユーザーの動画（複数タグのいずれか）

**入力**:
- ユーザー名: `favorite_creator`
- タグ（OR条件）: `animation, motion`

**生成される検索式**:
```
{author: [favorite_creator]} {tags: [animation, motion]}
```

### 例3: 一般向けMMD動画（複数タグ除外）

**入力**:
- タグ（AND条件）: `mmd`
- レーティング: `general`
- タグ（NOT条件）: `test, wip`

**生成される検索式**:
```
{tags: [mmd]} {rating=general} {tags: ![test]} {tags: ![wip]}
```

## 🛠️ 開発

### ファイル構成

```
iwara-search-form/
├── .github/
│   └── workflows/
│       └── deploy-pages.yml  # GitHub Pages自動デプロイ
├── index.html    # メインHTML（フォーム構造）
├── style.css     # スタイルシート（デザイン）
├── script.js     # JavaScript（ロジック）
├── tags_all.json # タグデータ
└── README.md     # このファイル
```

### 技術スタック

- HTML5
- CSS3（レスポンシブデザイン）
- Vanilla JavaScript（フレームワーク不使用）

### カスタマイズ

各ファイルは独立しているため、カスタマイズが容易です：

- **デザイン変更**: `style.css` の CSS変数を編集
- **機能追加**: `script.js` に新しいフィールド処理を追加
- **フィールド追加**: `index.html` にフォーム要素を追加後、`script.js` で処理を追加

### 自動デプロイ

GitHub Actionsを使用して、`main`ブランチへのプッシュ時に自動的にGitHub Pagesへデプロイされます：

- **ワークフロー**: `.github/workflows/deploy-pages.yml`
- **トリガー**: `main`ブランチへのpush、または手動実行
- **デプロイ先**: GitHub Pages（リポジトリの設定で有効化が必要）

#### GitHub Pagesの有効化手順

1. リポジトリの「Settings」→「Pages」を開く
2. 「Source」で「GitHub Actions」を選択
3. ファイルを`main`ブランチにプッシュすると自動的にデプロイされます

## 📝 参考資料

- [Iwara検索機能アップデート公式アナウンス](https://www.iwara.tv/forum/announcements/2520f68b-b13f-42db-834b-8ab9a2017ad4/2025-08-16-search-update-or-or)

## 🤝 コントリビューション

バグ報告や機能追加の提案は、Issuesまたはプルリクエストでお願いします。

## 📄 ライセンス

MIT License

## 🔒 プライバシー

このツールは完全にクライアントサイドで動作し、入力されたデータは一切外部に送信されません。すべての処理はブラウザ内で完結します。
